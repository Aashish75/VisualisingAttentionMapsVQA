<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attention Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f8f9fa;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #007bff;
            margin-bottom: 20px;
        }
        .container {
            max-width: 800px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .image-display {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .dropdown {
            width: 100%;
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }
        select, button {
            width: 48%;
            padding: 8px;
            font-size: 1rem;
            border-radius: 4px;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .result-input {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Visualising attention maps as evidence for Visual Question Answering</h1>
    <div class="container">
        <!-- Display Default or Uploaded Image -->
        <img src="default-image.jpg" alt="Default Image" id="inputImage" class="image-display">
        
        <!-- Dropdowns for Image Input and Method Selection -->
        <div class="dropdown">
            <select id="imageInput" onchange="handleImageInputChange()">
                <option value="default">Use Default Image</option>
                <option value="camera">Take a Picture</option>
                <option value="upload">Select from Computer</option>
                <option value="ex1">Example Image 1</option>
                <option value="ex2">Example Image 2</option>
            </select>

            <select id="methodSelect" onchange="handleMethodChange()">
                <option value="method1">Method 1</option>
                <option value="method2">Method 2</option>
                <option value="method3">Method 3</option>
            </select>
        </div>

        <!-- Text box for displaying the result image URL -->
        <input type="text" id="resultImageUrl" class="result-input" placeholder="Result Image URL will appear here" readonly>
    </div>

    <script>
        const apiUrl = "https://huggingface.co/spaces/Aashish75/https://aashish75-attentionvisualisationvqa.hf.space/gradio_api/call/predict/"; // Replace with your Hugging Face Space API endpoint

        // Placeholder functions to handle dropdown changes and display image
        function handleImageInputChange() {
            const inputType = document.getElementById("imageInput").value;
            const inputImage = document.getElementById("inputImage");

            if (inputType === "default") {
                inputImage.src = "default-image.jpg";
            } else if (inputType === "ex1") {
                inputImage.src = "example1.jpg";
            } else if (inputType === "ex2") {
                inputImage.src = "example2.jpg";
            } else if (inputType === "upload") {
                const inputFile = document.createElement("input");
                inputFile.type = "file";
                inputFile.accept = "image/*";
                inputFile.onchange = (e) => {
                    const file = e.target.files[0];
                    inputImage.src = URL.createObjectURL(file);
                };
                inputFile.click();
            } else if (inputType === "camera") {
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    navigator.mediaDevices.getUserMedia({ video: true })
                        .then((stream) => {
                            const video = document.createElement("video");
                            video.srcObject = stream;
                            video.play();

                            video.onloadeddata = () => {
                                const canvas = document.createElement("canvas");
                                canvas.width = video.videoWidth;
                                canvas.height = video.videoHeight;
                                const context = canvas.getContext("2d");
                                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                                inputImage.src = canvas.toDataURL("image/png");
                                stream.getTracks().forEach(track => track.stop());
                            };
                        });
                } else {
                    alert("Camera not supported on this device");
                }
            }
        }

        function handleMethodChange() {
            const method = document.getElementById("methodSelect").value;
            const resultImageUrl = document.getElementById("resultImageUrl");
            const inputImage = document.getElementById("inputImage");

            // Send the image data to Hugging Face Space API
            sendImageToHuggingFace(inputImage.src, method)
                .then(result => {
                    resultImageUrl.value = result; // Display the result image URL in the text box
                })
                .catch(error => {
                    console.error('Error fetching result:', error);
                    alert('Error processing the image.');
                });
        }

        async function sendImageToHuggingFace(imageSrc, method) {
            const resultImageUrl = await fetch(apiUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": 'Bearer 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'
                },
                body: JSON.stringify({
                      data: [imageSrc, method], // Match Gradio input structure
                      })
            }).then(res => res.json());

            return resultImageUrl.data[0]; // Assuming the response contains a processed image URL
        }
    </script>
</body>
</html>
